CREATE DATABASE PIZZA_DB;

USE PIZZA_DB;

SET SQL_SAFE_UPDATES=0;

UPDATE pizza_sales
SET ORDER_DATE=str_to_date(ORDER_DATE,'%d-%m-%Y');

ALTER TABLE pizza_sales
MODIFY COLUMN ORDER_DATE DATE;

UPDATE pizza_sales
SET ORDER_TIME=str_to_date(ORDER_TIME,"%H:%i:%s");

ALTER TABLE pizza_sales 
MODIFY COLUMN ORDER_TIME TIME;



-- A.KPI'S
-- 1.TOTAL REVENUE
SELECT ROUND(SUM(TOTAL_PRICE),2) AS TOTAL_REVENUE
FROM PIZZA_SALES;

-- 2. AVG ORDER VALUE 
SELECT ROUND(SUM(TOTAL_PRICE)/ COUNT(DISTINCT ORDER_ID),2) AS AVG_ORDER_VALUE 
FROM PIZZA_SALES;

-- 3. TOTAL PIZZAS SOLD
SELECT SUM(QUANTITY) AS TOTAL_PIZZAS_SOLD
FROM PIZZA_SALES;

-- 4.TOTAL NUMBER OF ORDERS
SELECT COUNT(distinct ORDER_ID) AS TOTAL_ORDERS
FROM PIZZA_SALES;

-- AVG PIZZAS PER ORDER
SELECT SUM(QUANTITY)/COUNT(distinct ORDER_ID) AS AVG_PIZZAS_PER_ORDER
FROM PIZZA_SALES;

-- DAILY TREND FOR TOTAL ORDERS
SELECT dayname(ORDER_DATE) AS DAY, COUNT(DISTINCT ORDER_ID) AS TOTAL_ORDERS
FROM PIZZA_SALES
GROUP BY dayname(ORDER_DATE);

-- MONTHLY TREND FOR DAILY ORDERS
SELECT monthname(ORDER_DATE) AS MONTH_NAME,COUNT(DISTINCT ORDER_ID) AS TOTAL_ORDERS
FROM PIZZA_SALES
GROUP BY monthname(ORDER_DATE)
ORDER BY TOTAL_ORDERS DESC;

-- PERCENTAGE OF SALES BY PIZZA CATEGORY
SELECT PIZZA_CATEGORY, CONCAT(ROUND((SUM(TOTAL_PRICE)/(SELECT SUM(TOTAL_PRICE) FROM PIZZA_SALES))*100,2),"%") AS PERC_TOTAL_SALES
FROM PIZZA_SALES
GROUP BY PIZZA_CATEGORY;

-- PERCENTAGE OF SALES BY PIZZA SIZE
SELECT PIZZA_SIZE,CONCAT(ROUND((SUM(TOTAL_PRICE)/(SELECT SUM(TOTAL_PRICE) FROM PIZZA_SALES))*100,2),"%") AS PERC_TOTAL_SALES
FROM PIZZA_SALES
GROUP BY PIZZA_SIZE
ORDER BY PERC_TOTAL_SALES ;

-- TOTAL PIZZA SOLD BY PIZZA CATEGORY
SELECT PIZZA_CATEGORY,SUM(QUANTITY) AS TOTAL_PIZZA_SOLD
FROM PIZZA_SALES
GROUP BY PIZZA_CATEGORY;

-- TOP 5 BEST SELLERS BY TOTAL PIZZAS SOLD
SELECT PIZZA_NAME ,SUM(TOTAL_PRICE) AS TOTAL_REVENUE
FROM PIZZA_SALES
GROUP BY PIZZA_NAME
ORDER BY TOTAL_REVENUE DESC
LIMIT 5;

-- BOTTOM 5 BEST SELLERS BY TOTAL PIZZAS SOLD
SELECT PIZZA_NAME ,SUM(TOTAL_PRICE) AS TOTAL_REVENUE
FROM PIZZA_SALES
GROUP BY PIZZA_NAME
ORDER BY TOTAL_REVENUE 
LIMIT 5;

-- TOP 5 BEST SELLERS BY TOTAL PIZZAS QUANTITY
SELECT PIZZA_NAME ,SUM(QUANTITY) AS TOTAL_QTD
FROM PIZZA_SALES
GROUP BY PIZZA_NAME
ORDER BY TOTAL_QTD DESC
LIMIT 5;

-- BOTTOM 5 BEST SELLERS BY TOTAL PIZZAS QUANTITY
SELECT PIZZA_NAME ,SUM(QUANTITY) AS TOTAL_QTD
FROM PIZZA_SALES
GROUP BY PIZZA_NAME
ORDER BY TOTAL_QTD 
LIMIT 5;

-- TOP 5 BEST SELLERS BY TOTAL PIZZAS ORDER_COUNT
SELECT PIZZA_NAME ,COUNT(DISTINCT ORDER_ID) AS TOTAL_ORDERS
FROM PIZZA_SALES
GROUP BY PIZZA_NAME
ORDER BY TOTAL_ORDERS DESC
LIMIT 5;

-- BOTTOM 5 BEST SELLERS BY TOTAL PIZZAS ORDER_COUNT
SELECT PIZZA_NAME ,COUNT(DISTINCT ORDER_ID) AS TOTAL_ORDERS
FROM PIZZA_SALES
GROUP BY PIZZA_NAME
ORDER BY TOTAL_ORDERS 
LIMIT 5;
